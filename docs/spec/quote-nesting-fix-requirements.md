# 引用ネスト時のフォントサイズ問題修正 要件定義書

## 概要

ブログサイトにおいて、引用（blockquote）がネストされる際にフォントサイズが意図せず大きくなる問題が発生している。この問題により、選択部分や引用が深くネストされるたびに視覚的な一貫性が失われ、ユーザビリティが低下している。

## ユーザストーリー

### ストーリー1: 適切な引用表示

- **である** ブログ読者 **として**
- **私は** ネストされた引用を適切なフォントサイズで読みたい
- **そうすることで** 引用の階層を理解しながら自然に読み進められる

### ストーリー2: 一貫したスタイリング

- **である** コンテンツ作成者 **として**
- **私は** 複数レベルの引用を使用しても視覚的に一貫したデザインを保ちたい
- **そうすることで** 読みやすく美しいコンテンツを提供できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは通常のblockquoteに対して0.95emのフォントサイズを適用しなければならない
- REQ-002: システムは引用のネストレベルに関わらず一定のフォントサイズを維持しなければならない
- REQ-003: システムはcallout機能（.calloutクラス）を引用スタイルの影響から分離しなければならない

### 条件付き要件

- REQ-101: 引用がネストされた場合、システムはフォントサイズの継承や累積的な増大を防止しなければならない
- REQ-102: blockquoteセレクタが複数レベルで適用された場合、システムは最上位の要件のみを適用しなければならない

### 状態要件

- REQ-201: calloutクラスが適用されている状態にある場合、システムは通常の引用スタイルを適用してはならない
- REQ-202: 通常のMarkdown引用記法が使用されている状態にある場合、システムは適切な引用スタイルを適用しなければならない

### 制約要件

- REQ-401: システムは既存のcallout機能に影響を与えてはならない
- REQ-402: システムは通常のMarkdown記法の表示に影響を与えてはならない
- REQ-403: システムはレスポンシブデザインを維持しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: CSSの変更によるレンダリング性能の劣化があってはならない
- NFR-002: ページロード時間に与える影響は5%以下でなければならない

### 互換性

- NFR-101: 既存のブログ記事の表示に破綻的変更があってはならない
- NFR-102: モバイルデバイスでの表示が適切に動作しなければならない

### メンテナビリティ

- NFR-201: CSSセレクタの優先度が適切に管理されていなければならない
- NFR-202: 将来的なデザイン変更に柔軟に対応できる構造でなければならない

## Edgeケース

### ネスト構造の処理

- EDGE-001: 3レベル以上の深いネストでもフォントサイズが安定していること
- EDGE-002: callout内にネストされた引用が適切に表示されること
- EDGE-003: 引用内にcalloutが含まれる場合の適切な表示

### Markdown記法の組み合わせ

- EDGE-101: 引用内のリスト、テーブル、コードブロックの表示が適切であること
- EDGE-102: 引用内のWikiLinkが正常に動作すること

### レスポンシブ対応

- EDGE-201: 画面サイズが720px以下の場合の適切な表示
- EDGE-202: フォントサイズ調整によるレイアウト崩れの防止

## 受け入れ基準

### 機能テスト

- [ ] 通常のblockquoteが0.95emのフォントサイズで表示される
- [ ] 2レベルネストされた引用でフォントサイズが変化しない
- [ ] 3レベルネストされた引用でフォントサイズが変化しない
- [ ] calloutクラスを持つ要素が引用スタイルの影響を受けない
- [ ] 引用の左ボーダー（4px solid var(--accent)）が正常に表示される
- [ ] 引用のパディング（0 0 0 20px）が正常に適用される

### 互換性テスト

- [ ] 既存のブログ記事の表示に変化がない
- [ ] callout機能が正常に動作する
- [ ] WikiLink機能が引用内で正常に動作する
- [ ] レスポンシブデザインが維持される

### 非機能テスト

- [ ] ページロード時間が基準値内に収まる
- [ ] モバイルデバイスでの表示が適切
- [ ] CSSの優先度が適切に設定されている

## 技術的実装要件

### CSSセレクタの修正

- IMPL-001: `:not(.callout)`セレクタを使用してcalloutとの分離を確実にする
- IMPL-002: フォントサイズの継承を防ぐためのCSSプロパティを適用する
- IMPL-003: セレクタの詳細度を適切に管理する

### テスト対象ファイル

- IMPL-101: `/src/styles/global.css`の124-129行目の修正
- IMPL-102: `/src/content/blog/markdown-basic-test/index.md`でのテスト
- IMPL-103: `/src/content/blog/wikilink-test/index.md`でのテスト