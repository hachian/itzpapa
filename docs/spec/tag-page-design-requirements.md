# 個別タグページデザイン改善 要件定義書

## 概要

個別タグページのデザイン問題を修正し、ユーザビリティとアクセシビリティを向上させる改善プロジェクトです。

## ユーザストーリー

### ストーリー1: URLの一貫性

- **である** ブログ読者 **として**
- **私は** タグ一覧から階層タグをクリックしたとき **に正しいページに遷移したい**
- **そうすることで** 迷うことなくタグ記事を閲覧できる

### ストーリー2: 視覚的一貫性

- **である** ブログ読者 **として**
- **私は** タグバッジが **どのコンテキストでも同じ高さで表示されることを期待する**
- **そうすることで** 統一された美しいレイアウトを体験できる

### ストーリー3: モバイル対応

- **である** モバイルユーザー **として**
- **私は** 個別タグページが **モバイル画面で読みやすく表示されることを期待する**
- **そうすることで** どのデバイスからでも快適にタグ記事を閲覧できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは階層タグのURLをスラッシュ区切り形式（/tags/parent/child）で生成しなければならない
- REQ-002: システムはタグバッジコンポーネントをすべてのコンテキストで統一された高さで表示しなければならない
- REQ-003: システムは個別タグページのレスポンシブレイアウトを提供しなければならない

### 条件付き要件

- REQ-101: 階層タグリンクがクリックされた場合、システムは正しい階層URL（/tags/tech/web）に遷移しなければならない
- REQ-102: TagTreeコンポーネントでタグリンクが生成される場合、システムはスラッシュ区切りURLを使用しなければならない
- REQ-103: 画面幅が768px以下の場合、システムはモバイル用レイアウトを適用しなければならない

### 状態要件

- REQ-201: TagBadgeコンポーネントが記事一覧に表示されている状態で、高さは他のタグバッジと揃っていなければならない
- REQ-202: パンくずナビゲーションが表示されている状態で、各階層リンクは正しいURLを持たなければならない

### オプション要件

- REQ-302: システムはタグページでアニメーション効果を提供してもよい

### 制約要件

- REQ-401: システムは既存のタグURLとの後方互換性を維持しなければならない
- REQ-402: システムはCSS変数システムを使用してスタイルを管理しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: タグページの初期表示は3秒以内に完了すること
- NFR-002: タグリンククリック時の遷移は1秒以内に完了すること

### ユーザビリティ

- NFR-101: タグバッジの最小タップサイズは44px×44pxを確保すること
- NFR-102: パンくずナビゲーションはキーボードナビゲーションに対応すること

### アクセシビリティ

- NFR-201: すべてのタグリンクに適切なaria-labelを設定すること
- NFR-202: カラーコントラスト比はWCAG AA基準を満たすこと

## Edgeケース

### エラー処理

- EDGE-001: 存在しない階層タグURLにアクセスした場合、適切な404ページを表示する
- EDGE-002: TagTreeコンポーネントでJavaScriptが無効な場合でも、タグリンクは機能する

### 境界値

- EDGE-101: 階層が5レベル以上深い場合でも、適切にレンダリングされる
- EDGE-102: タグ名が日本語・特殊文字を含む場合でも、URLエンコーディングが正しく動作する

### レスポンシブ境界

- EDGE-201: 画面幅320px（最小モバイル）でもレイアウトが崩れない
- EDGE-202: 画面幅1920px（大型デスクトップ）でも適切に表示される

## 受け入れ基準

### 機能テスト

- [ ] タグ一覧から階層タグ「tech/web」をクリックして、正しく/tags/tech/webに遷移する
- [ ] 個別タグページでタグバッジの高さが統一されている
- [ ] パンくずナビゲーションのリンクが正しいURLを持つ
- [ ] モバイル表示でレイアウトが適切に調整される

### 非機能テスト

- [ ] タグページ表示速度が3秒以内
- [ ] タグバッジの最小タップサイズが44px確保されている
- [ ] ダークモード切替でスタイルが正しく適用される
- [ ] キーボードナビゲーションですべてのリンクにアクセス可能

### 回帰テスト

- [ ] 既存の単一タグページ（/tags/markdown等）が正常に動作する
- [ ] 既存のタグ一覧ページ機能に影響がない
- [ ] タグバッジコンポーネントの他の使用箇所に影響がない

## 実装上の重要な修正ポイント

1. **TagTree.astro**: `baseUrl`パラメータとタグスラッグ生成ロジックの修正
2. **TagBadge.astro**: 高さ統一のためのCSS変数調整
3. **[...slug].astro**: パンくずナビゲーションURL生成の確認
4. **tag-variables.css**: レスポンシブ対応CSS変数の追加

## 影響範囲

- タグ一覧ページ（/tags/index.astro）
- 個別タグページ（/tags/[...slug].astro）
- TagTreeコンポーネント（/components/TagTree.astro）
- TagBadgeコンポーネント（/components/TagBadge.astro）
- タグ関連CSS（/styles/tag-variables.css）