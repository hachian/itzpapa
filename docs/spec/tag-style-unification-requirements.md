# タグスタイル統一 要件定義書

## 概要

全てのタグ表示において、階層タグのスタイルに統一し、タグとその出現回数を一貫した形式で表示する。これにより、記事内のインラインタグ、記事のフロントマターのタグ、タグ一覧、階層タグツリーなど、すべてのタグ表示で統一感のあるユーザーエクスペリエンスを提供する。

## ユーザストーリー

### ストーリー1: 統一されたタグ表示の体験

- **である** ブログ読者 **として**
- **私は** どこに表示されているタグも同じスタイルで表示される **ことを望む**
- **そうすることで** 視覚的に一貫性があり、タグの識別と理解が容易になる

### ストーリー2: タグ出現回数の可視化

- **である** コンテンツ管理者 **として**
- **私は** すべてのタグ表示で出現回数を確認できる **ことを望む**
- **そうすることで** タグの使用頻度を把握し、コンテンツの分類状況を理解できる

### ストーリー3: 階層タグと単一タグの区別

- **である** ブログ読者 **として**
- **私は** 階層タグも単一タグも同じ視覚的重要度で表示される **ことを望む**
- **そうすることで** タグの種類に関わらず、一貫した情報価値を感じられる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは すべてのタグを統一されたスタイルで表示 しなければならない
- REQ-002: システムは タグ名と出現回数を一貫した形式で表示 しなければならない
- REQ-003: システムは 階層タグと単一タグを同じ視覚的スタイルで表示 しなければならない
- REQ-004: システムは インラインタグにもタグバッジコンポーネントのスタイルを適用 しなければならない
- REQ-005: システムは フロントマターのタグにも同じスタイルを適用 しなければならない

### 条件付き要件

- REQ-101: タグに出現回数データが存在する場合、システムは 出現回数をタグ名の隣に表示 しなければならない
- REQ-102: showCountプロパティがtrueの場合、システムは タグの出現回数を表示 しなければならない
- REQ-103: タグがリンクとして機能する場合、システムは ホバー効果を適用 しなければならない
- REQ-104: ダークモードが有効な場合、システムは ダークモード用のスタイルを適用 しなければならない
- REQ-105: 画面幅が640px以下の場合、システムは レスポンシブ用のスタイルを適用 しなければならない

### 状態要件

- REQ-201: タグがホバー状態にある場合、システムは 背景色と文字色を変更して視覚的フィードバックを提供 しなければならない
- REQ-202: タグがフォーカス状態にある場合、システムは アウトラインを表示してアクセシビリティを確保 しなければならない
- REQ-203: 階層タグツリーで折りたたまれた状態にある場合でも、システムは 表示されているタグに統一スタイルを適用 しなければならない

### オプション要件

- REQ-301: システムは タグの使用頻度に応じてフォントサイズを調整する機能を提供 してもよい
- REQ-302: システムは タグアイコンをカスタマイズする機能を提供 してもよい
- REQ-303: システムは タグの色をカテゴリごとにカスタマイズする機能を提供 してもよい

### 制約要件

- REQ-401: システムは 既存のTagBadgeコンポーネントのスタイルを基準として使用 しなければならない
- REQ-402: システムは CSS変数を使用して色とスタイルを管理 しなければならない
- REQ-403: システムは タグ表示のパフォーマンスを維持（100個以上のタグで60fps以上） しなければならない
- REQ-404: システムは WCAG 2.1 AAレベルのアクセシビリティ基準を満たす しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: タグの描画は100ミリ秒以内に完了すること
- NFR-002: 大量のタグ（100個以上）を含むページでも、スクロールが60fps以上を維持すること
- NFR-003: CSSの総サイズは10KB以下に抑えること

### セキュリティ

- NFR-101: タグ名に含まれる特殊文字は適切にエスケープされること
- NFR-102: XSS攻撃を防ぐため、ユーザー入力によるスタイル注入を防止すること

### ユーザビリティ

- NFR-201: タグは最小44×44ピクセルのタップ領域を確保すること（モバイル）
- NFR-202: 色のコントラスト比は4.5:1以上を確保すること
- NFR-203: キーボードナビゲーションに完全対応すること
- NFR-204: スクリーンリーダーで適切に読み上げられること

### 保守性

- NFR-301: スタイルはCSS変数で一元管理されること
- NFR-302: コンポーネントは再利用可能な形で実装されること
- NFR-303: スタイルの変更が他のコンポーネントに影響しないよう適切にスコープされること

## Edgeケース

### エラー処理

- EDGE-001: タグ名が空の場合、デフォルトの「未分類」タグとして表示する
- EDGE-002: 出現回数が0または負の値の場合、カウントを非表示にする
- EDGE-003: タグ名が極端に長い場合（50文字以上）、省略表示とツールチップを提供する

### 境界値

- EDGE-101: 出現回数が999を超える場合、「999+」と表示する
- EDGE-102: タグが1つも存在しない場合、「タグなし」メッセージを表示する
- EDGE-103: 階層が5レベルを超える場合、5レベルまでの表示に制限する

### 特殊ケース

- EDGE-201: 日本語、中国語、韓国語などのマルチバイト文字を含むタグの正しい表示
- EDGE-202: RTL（右から左）言語でのタグ表示の対応
- EDGE-203: 絵文字を含むタグ名の適切な処理

## 実装詳細

### 統一するスタイル要素

1. **基本スタイル**
   - 背景色: `var(--tag-bg, #e1f5fe)`
   - 文字色: `var(--tag-color, #0277bd)`
   - ボーダー: `1px solid var(--tag-border, #b3e5fc)`
   - 角丸: `1rem`
   - パディング: `0.2em 0.6em`
   - フォントサイズ: `0.875rem`
   - フォントウェイト: `500`

2. **出現回数表示**
   - 背景色: `rgba(255, 255, 255, 0.3)`
   - パディング: `0.1em 0.4em`
   - 角丸: `0.75rem`
   - フォントサイズ: `0.75em`
   - 最小幅: `1.2em`

3. **ホバー効果**
   - 背景色変更
   - Y軸移動: `-1px`
   - ボックスシャドウ追加

### 影響を受けるコンポーネント

1. `/src/components/TagBadge.astro` - ベースとなるタグコンポーネント
2. `/src/components/TagList.astro` - タグリスト表示
3. `/src/components/TagTree.astro` - 階層タグツリー
4. `/src/utils/tag/inline-tags.ts` - インラインタグ処理
5. `/src/styles/tag.css` - グローバルタグスタイル

## 受け入れ基準

### 機能テスト

- [ ] TagBadgeコンポーネントで階層タグと単一タグが同じスタイルで表示される
- [ ] TagListコンポーネントですべてのタグが統一スタイルで表示される
- [ ] TagTreeコンポーネントのタグがTagBadgeと同じスタイルを使用している
- [ ] インラインタグがTagBadgeと同じスタイルで表示される
- [ ] フロントマターのタグが統一スタイルで表示される
- [ ] 出現回数が正しく表示される
- [ ] ホバー効果が全てのタグで一貫して動作する
- [ ] ダークモードでスタイルが適切に切り替わる
- [ ] モバイル表示でレスポンシブスタイルが適用される

### 非機能テスト

- [ ] 100個のタグを含むページで60fps以上のスクロールパフォーマンス
- [ ] タグのレンダリング時間が100ミリ秒以内
- [ ] キーボードナビゲーションが正常に動作
- [ ] スクリーンリーダーで適切に読み上げられる
- [ ] 色のコントラスト比が4.5:1以上
- [ ] モバイルでタップ領域が44×44ピクセル以上

### 視覚的確認

- [ ] 階層タグと単一タグの見た目が統一されている
- [ ] 出現回数の表示位置とスタイルが一貫している
- [ ] ダークモードとライトモードで適切な色が使用されている
- [ ] アニメーションが滑らかに動作する

## 実装順序

1. TagBadgeコンポーネントのスタイルを階層タグスタイルに統一
2. インラインタグ処理をTagBadgeコンポーネントを使用するように変更
3. TagTreeコンポーネントでTagBadgeのスタイルを完全に適用
4. グローバルCSSの整理と統一
5. テストとドキュメントの更新