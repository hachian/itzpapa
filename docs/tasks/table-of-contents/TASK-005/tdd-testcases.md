# TASK-005: アクティブ状態管理機能 - テストケース

## テストケース一覧

### 1. 初期化テスト

#### TC-001: Intersection Observer の初期化
- **前提条件**: ページに見出し要素が存在する
- **実行**: ページ読み込み完了
- **期待結果**:
  - Intersection Observer が作成される
  - すべての見出し要素が監視対象になる

#### TC-002: 要素が存在しない場合
- **前提条件**: 見出し要素が存在しない
- **実行**: ページ読み込み完了
- **期待結果**: エラーが発生しない、Observer は作成されない

### 2. アクティブ状態管理テスト

#### TC-003: 単一見出しの表示
- **前提条件**: 1つの見出しがビューポート内に表示
- **実行**: 見出しセクションにスクロール
- **期待結果**: 対応する目次項目に `active` クラスが付与される

#### TC-004: 見出しの非表示
- **前提条件**: アクティブな見出しがビューポート外へ
- **実行**: 別のセクションへスクロール
- **期待結果**: `active` クラスが削除される

#### TC-005: 複数見出しの同時表示
- **前提条件**: 2つ以上の見出しが同時に表示
- **実行**: 複数見出しが表示される位置へスクロール
- **期待結果**: 最上部の見出しに対応する項目のみアクティブ

### 3. エッジケーステスト

#### TC-006: ページトップでの挙動
- **前提条件**: ページ最上部
- **実行**: ページ読み込みまたは最上部へスクロール
- **期待結果**: 最初の目次項目がアクティブ

#### TC-007: ページ最下部での挙動
- **前提条件**: ページ最下部
- **実行**: 最下部へスクロール
- **期待結果**: 最後の見出しに対応する項目がアクティブ

#### TC-008: 高速スクロール
- **前提条件**: 長いページ
- **実行**: 高速でスクロール
- **期待結果**:
  - パフォーマンス劣化なし
  - 正しくアクティブ状態が更新

### 4. 互換性テスト

#### TC-009: Intersection Observer 非対応ブラウザ
- **前提条件**: IE11などの非対応ブラウザ
- **実行**: ページ読み込み
- **期待結果**:
  - エラーが発生しない
  - 基本的な目次機能は動作

#### TC-010: JavaScript無効環境
- **前提条件**: JavaScript無効
- **実行**: ページ表示
- **期待結果**:
  - 目次は表示される
  - クリックでジャンプ可能

### 5. 動的コンテンツテスト

#### TC-011: 見出しの動的追加
- **前提条件**: ページ読み込み後
- **実行**: 新しい見出し要素を追加
- **期待結果**: 新しい見出しも監視対象になる

#### TC-012: 見出しの動的削除
- **前提条件**: アクティブな見出しが存在
- **実行**: その見出しを削除
- **期待結果**:
  - エラーが発生しない
  - 次の見出しが適切にアクティブになる

## テスト実装方法

### 手動テスト
1. テストページで各シナリオを実行
2. ブラウザの開発者ツールでクラスの変化を確認
3. パフォーマンスプロファイラで性能を測定

### 自動テスト（Playwright使用）
```javascript
// 例: スクロール時のアクティブ状態確認
await page.goto('/test-page');
await page.evaluate(() => window.scrollTo(0, 500));
const activeItem = await page.$('.toc-link.active');
expect(await activeItem.textContent()).toBe('期待される見出し');
```

## 成功基準

- すべてのテストケースが成功
- パフォーマンス劣化がない（60FPS維持）
- 主要ブラウザで動作確認済み