# TASK-005: アクティブ状態管理機能 - 要件定義

## 機能概要

ユーザーがページをスクロールする際に、現在表示されているセクションに対応する目次項目を自動的にハイライト表示する機能を実装する。

## 詳細要件

### 1. 基本機能要件

- **自動検出**: ビューポート内に表示されている見出しを自動検出
- **アクティブ表示**: 該当する目次項目に `active` クラスを付与
- **リアルタイム更新**: スクロールに応じてリアルタイムで更新
- **プログレッシブエンハンスメント**: JavaScript無効時でも基本機能は動作

### 2. 技術要件

- **Intersection Observer API** を使用してパフォーマンスを最適化
- 見出し要素（H2, H3）を監視対象とする
- スロットリングは不要（Intersection Observer が最適化済み）

### 3. UI/UX要件

- アクティブ項目は視覚的に明確に区別される
- スムーズな状態切り替え（CSS transitionによる）
- 複数の見出しが同時に表示される場合は、最上部の見出しを優先

### 4. エッジケース

- 見出しが重なって表示される場合
- 短い見出しセクション（すぐに通過する）
- ページ最下部での挙動
- 動的に追加される見出しへの対応

## 受け入れ基準

1. **機能面**
   - [ ] スクロール時に正しい目次項目がアクティブになる
   - [ ] ページトップでは最初の項目がアクティブ
   - [ ] ページ最下部では最後の項目がアクティブ
   - [ ] 複数見出しが表示時は最上部を優先

2. **パフォーマンス面**
   - [ ] スクロールがスムーズ（60FPS維持）
   - [ ] メモリリークが発生しない
   - [ ] Observer の適切なクリーンアップ

3. **互換性**
   - [ ] Intersection Observer 対応ブラウザで動作
   - [ ] 非対応ブラウザでは graceful degradation
   - [ ] JavaScript無効時も目次は表示される

## 実装方針

1. **Client-side Script** として実装
2. **Astroの `<script>` タグ** 内に記述
3. **Progressive Enhancement** アプローチ
4. **CSS クラス** による状態管理

## テスト観点

1. **単体テスト**
   - Observer のコールバック関数
   - アクティブ状態の判定ロジック
   - クラスの追加/削除

2. **統合テスト**
   - スクロール時の挙動
   - 複数見出しの処理
   - エッジケース

3. **E2Eテスト**
   - 実際のブラウザでの動作確認
   - 異なるページ構造での動作