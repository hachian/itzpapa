# TASK-201: グローバルCSS整理と統一 - 要件定義

## 概要

現在のCSS構造を分析し、重複する定義を整理し、統一されたデザインシステムを構築する。特にタグ関連CSSの重複を解消し、メンテナンス性を向上させる。

## 詳細要件

### 機能要件

1. **CSS重複の除去** (REQ-201-001)
   - `tag.css` と `tag-variables.css` の重複定義を統合
   - `global.css` の古いタグスタイルを除去
   - 階層タグの重複定義（`tag-hierarchical`）を統一システムに統合

2. **変数システムの統一** (REQ-201-002)
   - `tag-variables.css` を唯一の変数定義ソースとする
   - `global.css` のハードコーディング色を変数化
   - ダークモード定義の重複を除去

3. **ファイル構造の最適化** (REQ-201-003)
   - CSS importの順序を最適化
   - 不要なスタイル定義を除去
   - コメントとドキュメンテーションの改善

### 技術要件

1. **重複除去対象**
   ```css
   /* tag.css の重複（除去対象） */
   html.dark .tag { background-color: #30363d; }   // 変数で管理済み
   .tag-hierarchical { ... }                        // 統一システムに統合済み
   
   /* global.css の古い定義（除去対象） */
   .tag-list { ... }                               // tag.cssに移動
   .tag-cloud { ... }                              // 独立ファイル化
   ```

2. **統一すべき色定義**
   ```css
   /* global.css のハードコーディング（変数化対象） */
   --accent: #2337ff;                              // 変数管理へ
   --gray-gradient: rgba(var(--gray-light), 50%), #fff;  // mark要素用変数へ
   ```

3. **ファイル分離**
   - mark要素スタイルを独立ファイル化
   - タグクラウドスタイルを独立ファイル化

### パフォーマンス要件

1. **CSSサイズ最適化**
   - 重複定義除去により20%以上のサイズ削減
   - 未使用セレクターの除去

2. **ロード時間最適化**
   - CSS import順序の最適化
   - クリティカルCSS（above-the-fold）の識別

## 受け入れ基準

### 必須条件

- [ ] `tag.css` から重複するダークモード定義が除去されている
- [ ] `global.css` の古いタグ関連スタイルが除去されている
- [ ] 階層タグ定義が統一システムに完全統合されている
- [ ] すべてのタグコンポーネントが正常に表示される
- [ ] ダークモード切り替えが正常に動作する

### 品質基準

- [ ] CSS重複が20%以上削減されている
- [ ] 変数定義が `tag-variables.css` に集約されている
- [ ] コメントとドキュメンテーションが充実している
- [ ] importの依存関係が明確化されている

### セキュリティ基準

- [ ] 既存のセキュリティレベルが維持されている
- [ ] 新しい脆弱性が導入されていない

## 影響範囲

### 変更対象ファイル
- `src/styles/global.css` - 重複除去と変数化
- `src/styles/tag.css` - 重複除去と整理
- `src/styles/tag-variables.css` - 変数追加と整理

### 新規作成ファイル
- `src/styles/mark.css` - mark要素専用スタイル
- `src/styles/tag-cloud.css` - タグクラウド専用スタイル
- `test/global-css-test.js` - CSS統合テスト
- `docs/implementation/TASK-201/` - TDDドキュメント

### 影響を受ける可能性があるファイル
- 全ページ（グローバルスタイル変更のため）
- タグを使用するすべてのコンポーネント

## 実装アプローチ

1. **現在のCSS分析**
   - 重複定義の特定
   - 未使用スタイルの識別
   - 変数化可能な値の抽出

2. **段階的リファクタリング**
   - Phase 1: 重複除去
   - Phase 2: 変数統一
   - Phase 3: ファイル分離
   - Phase 4: 最適化

3. **テスト戦略**
   - ビジュアル回帰テスト
   - CSS構文検証
   - パフォーマンス測定