# TASK-007: 専用テストスイートの作成 - テストケース

## テストケース概要

専用テストスイートの機能を検証するためのテストケース集。統合機能、レポート機能、CI/CD統合の動作を確認する。

## 1. テストスイート統合機能

### TSI-001: 基本実行機能
**目的**: 単一コマンドでの全テスト実行
**前提条件**: 全テストファイルが統合されている
**テスト手順**:
1. `npm run test:mark-highlight` を実行
2. 全テストカテゴリが実行されることを確認
3. 実行結果サマリーが表示されることを確認
**期待結果**: 
- 45個以上のテストケースが実行される
- 実行時間が30秒以内
- 成功率85%以上

### TSI-002: カテゴリ別実行
**目的**: テストカテゴリ別の選択実行
**テスト手順**:
1. `npm run test:mark-highlight --category=core` を実行
2. Core Tests のみが実行されることを確認
3. 他のカテゴリでも同様にテスト
**期待結果**: 
- Core: 15テスト実行
- Security: 10テスト実行
- Integration: 9テスト実行
- Performance: 6テスト実行

### TSI-003: 高速実行モード
**目的**: Smoke Tests の高速実行
**テスト手順**:
1. `npm run test:mark-highlight --fast` を実行
2. 重要なテストのみが実行されることを確認
3. 実行時間を測定
**期待結果**: 
- 10テスト以内の実行
- 実行時間5秒以内
- 重要機能の動作確認

### TSI-004: ウォッチモード
**目的**: ファイル変更時の自動再実行
**テスト手順**:
1. `npm run test:mark-highlight --watch` を実行
2. プラグインファイルを変更
3. 自動再実行されることを確認
**期待結果**: 
- ファイル変更検知
- 自動テスト再実行
- 変更に関連するテストのみ実行

## 2. レポート機能テスト

### TR-001: HTMLレポート生成
**目的**: HTML形式レポートの生成と内容確認
**テスト手順**:
1. `npm run test:mark-highlight --reporter=html` を実行
2. `test/reports/mark-highlight-report.html` が生成されることを確認
3. レポート内容を確認
**期待結果**:
- HTMLファイルの生成
- テスト結果の詳細表示
- 統計情報の表示
- 失敗テストの詳細情報

### TR-002: JSONレポート生成
**目的**: CI/CD対応JSON形式レポートの生成
**テスト手順**:
1. `npm run test:mark-highlight --reporter=json` を実行
2. `test/reports/mark-highlight-report.json` が生成されることを確認
3. JSON構造を検証
**期待結果**:
```json
{
  "summary": {
    "total": 45,
    "passed": 38,
    "failed": 7,
    "duration": 25.5,
    "coverage": 87.3
  },
  "categories": {...},
  "tests": [...],
  "timestamp": "2025-08-18T..."
}
```

### TR-003: カバレッジレポート
**目的**: コードカバレッジの測定と表示
**テスト手順**:
1. `npm run test:mark-highlight --coverage` を実行
2. カバレッジ情報が表示されることを確認
3. 閾値チェック機能を確認
**期待結果**:
- 行カバレッジ85%以上
- 関数カバレッジ90%以上  
- 分岐カバレッジ80%以上
- 未テスト箇所の特定

### TR-004: 時系列比較レポート
**目的**: テスト結果の履歴管理と比較
**テスト手順**:
1. 複数回テストを実行
2. 結果履歴が保存されることを確認
3. パフォーマンス変化を確認
**期待結果**:
- 結果履歴の保存
- パフォーマンス比較
- 回帰検出
- トレンド分析

## 3. カバレッジ機能テスト

### TC-001: コードカバレッジ測定
**目的**: 正確なカバレッジ測定
**テスト手順**:
1. カバレッジ機能付きでテスト実行
2. 主要関数のカバレッジを確認
3. 未テスト関数を特定
**期待結果**:
- `remarkMarkHighlight`: 95%以上
- `processTextWithMarkHighlight`: 90%以上
- `secureHtmlEscape`: 85%以上
- `optimizedContentProcessing`: 90%以上

### TC-002: カバレッジ閾値チェック
**目的**: カバレッジ閾値によるゲート機能
**テスト手順**:
1. カバレッジ閾値を設定（85%）
2. テストを実行
3. 閾値を下回る場合のエラー処理を確認
**期待結果**:
- 閾値以上: 正常終了（exit code 0）
- 閾値未満: エラー終了（exit code 1）
- 詳細な警告メッセージ

### TC-003: 未テスト箇所の特定
**目的**: テストが不足している箇所の特定
**テスト手順**:
1. カバレッジレポートを生成
2. 未テスト箇所のリストを確認
3. 優先度別の改善提案を確認
**期待結果**:
- 行単位での未テスト箇所特定
- 関数単位での未テスト箇所特定
- 改善提案の表示

## 4. 新規テストケース

### NT-001: 日本語処理テスト
**目的**: 日本語文字列の適切な処理
**入力**: `==重要な日本語テキスト==`
**期待値**: `<mark>重要な日本語テキスト</mark>`

### NT-002: 絵文字処理テスト
**目的**: 絵文字を含むテキストの処理
**入力**: `==重要 🚀 情報==`
**期待値**: `<mark>重要 🚀 情報</mark>`

### NT-003: 長いURL処理テスト
**目的**: 長いURLを含むリンクの処理
**入力**: `==[非常に長いタイトルのリンク](https://example.com/very/long/path/with/many/parameters?param1=value1&param2=value2)==`
**期待値**: `<mark><a href="https://example.com/very/long/path/with/many/parameters?param1=value1&param2=value2">非常に長いタイトルのリンク</a></mark>`

### NT-004: 複合記法の深いネスト
**目的**: 複雑なインライン記法の組み合わせ
**入力**: `==***[重要なリンク](https://example.com)***==`
**期待値**: `<mark><strong><em><a href="https://example.com">重要なリンク</a></em></strong></mark>`

### NT-005: 特殊文字エスケープ
**目的**: 特殊文字の適切なエスケープ
**入力**: `==価格: $29.99 (税込み)==`
**期待値**: `<mark>価格: $29.99 (税込み)</mark>`

## 5. パフォーマンステスト

### PT-001: 大量テスト実行時間
**目的**: 全テストの実行時間測定
**測定項目**: 45個以上のテストケース実行時間
**期待結果**: 30秒以内

### PT-002: 並列実行効率
**目的**: 並列実行による効率化
**測定方法**: 
1. 逐次実行時間を測定
2. 並列実行時間を測定
3. 効率化率を計算
**期待結果**: 40%以上の短縮

### PT-003: メモリ使用量
**目的**: テスト実行時のメモリ効率
**測定項目**: 
- テスト開始時メモリ使用量
- テスト終了時メモリ使用量
- ピークメモリ使用量
**期待結果**: 50MB以内の増加

### PT-004: パフォーマンス回帰検出
**目的**: パフォーマンス劣化の自動検出
**テスト手順**:
1. ベースラインを設定
2. パフォーマンス測定
3. 閾値超過時の警告確認
**期待結果**: 10%以上の劣化で警告

## 6. CI/CD統合テスト

### CI-001: GitHub Actions統合
**目的**: GitHub Actionsでの自動実行
**テスト環境**: Ubuntu, macOS, Windows
**Node.jsバージョン**: 16, 18, 20
**期待結果**: 全環境での正常実行

### CI-002: テスト失敗時の処理
**目的**: テスト失敗時の適切なエラー処理
**テスト手順**:
1. 意図的にテストを失敗させる
2. CI/CDでの処理を確認
3. 通知機能を確認
**期待結果**: 
- 適切なexit code設定
- 失敗理由の明確な表示
- アーティファクトの保存

### CI-003: レポートアーカイブ
**目的**: テストレポートの自動保存
**テスト手順**:
1. CI/CDでテスト実行
2. レポートファイルの生成確認
3. アーティファクトとしての保存確認
**期待結果**: 
- HTMLレポートの保存
- JSONレポートの保存
- カバレッジレポートの保存

## 7. エラーハンドリングテスト

### EH-001: 設定ファイルエラー
**目的**: 不正な設定ファイルの処理
**テスト手順**:
1. 設定ファイルを破損させる
2. テスト実行を試行
3. エラーメッセージを確認
**期待結果**: 適切なエラーメッセージと復旧方法の提示

### EH-002: 依存関係エラー
**目的**: テスト依存関係の問題処理
**テスト手順**:
1. 必要な依存関係を削除
2. テスト実行を試行
3. エラー処理を確認
**期待結果**: 不足している依存関係の明確な表示

### EH-003: テストファイル不正
**目的**: テストファイルの構文エラー処理
**テスト手順**:
1. テストファイルに構文エラーを導入
2. テスト実行を試行
3. エラー箇所の特定確認
**期待結果**: エラーファイルと行番号の明確な表示

## 合格基準

### 必須要件（100%達成必要）
- [ ] TSI-001〜004: テストスイート統合機能
- [ ] TR-001〜003: レポート機能（JSONレポートは除く）
- [ ] TC-001〜002: カバレッジ測定と閾値チェック
- [ ] PT-001: 全テスト30秒以内実行

### 推奨要件（80%以上達成）
- [ ] TR-004: 時系列比較レポート
- [ ] NT-001〜005: 新規テストケース
- [ ] PT-002〜004: パフォーマンス最適化
- [ ] CI-001〜003: CI/CD統合

### オプション要件（努力目標）
- [ ] TC-003: 未テスト箇所の特定
- [ ] EH-001〜003: エラーハンドリング
- [ ] 追加的なビジュアルテスト
- [ ] 高度なカバレッジ分析