# TASK-005: パフォーマンス最適化 - テストケース

## テストケース概要

パフォーマンス最適化の効果を検証するためのテストケース集。処理速度、メモリ使用量、および機能の維持を確認する。

## 1. パフォーマンステスト

### PT-001: 小規模テキスト処理速度
**目的**: 小規模なテキストの処理速度を測定
**前提条件**: 100文字、2個のハイライト
**テスト手順**:
1. 100文字のテキストに2個の`==ハイライト==`を含む
2. 処理時間を測定
3. 10回実行して平均を取る
**期待結果**: 10ms以下
**実際の入力**:
```markdown
これは小規模なテストテキストです。==最初のハイライト==があり、続いて==2番目のハイライト==もあります。
```

### PT-002: 中規模テキスト処理速度
**目的**: 中規模なテキストの処理速度を測定
**前提条件**: 1000文字、10個のハイライト
**テスト手順**:
1. 1000文字のテキストに10個のハイライトを含む
2. 処理時間を測定
3. 5回実行して平均を取る
**期待結果**: 100ms以下
**実際の入力**: ループで生成

### PT-003: 大規模テキスト処理速度
**目的**: 大規模なテキストの処理速度を測定
**前提条件**: 10000文字、50個のハイライト
**テスト手順**:
1. 10000文字のテキストに50個のハイライトを含む
2. 処理時間を測定
3. 3回実行して平均を取る
**期待結果**: 1000ms以下

### PT-004: 複雑なパターン処理速度
**目的**: 複雑なインライン記法を含む処理速度
**前提条件**: ネストした記法、インライン記法の組み合わせ
**テスト手順**:
1. `==**太字**==`、`==*イタリック*==`、`==[リンク](url)==`を含む
2. 処理時間を測定
**期待結果**: 単純な記法と比較して2倍以内

## 2. メモリ使用量テスト

### MT-001: 基本メモリ使用量
**目的**: 基本的な処理でのメモリ使用量測定
**前提条件**: 標準的なドキュメント（5KB）
**テスト手順**:
1. 処理前のメモリ使用量を記録
2. プラグインを実行
3. 処理後のメモリ使用量を記録
4. 差分を計算
**期待結果**: 5MB以下の増加

### MT-002: メモリリーク検証
**目的**: メモリリークがないことを確認
**前提条件**: 同じ処理を100回繰り返し
**テスト手順**:
1. 初期メモリ使用量を記録
2. 同じテキストを100回処理
3. 最終メモリ使用量を記録
**期待結果**: メモリ増加が初回処理の2倍以内

### MT-003: 大規模データのメモリ効率
**目的**: 大規模データ処理時のメモリ効率
**前提条件**: 100KBのマークダウンファイル
**テスト手順**:
1. 大規模ファイルを処理
2. ピークメモリ使用量を測定
**期待結果**: ファイルサイズの3倍以内

## 3. 機能維持テスト

### FT-001: 基本機能の維持
**目的**: 最適化後も基本機能が動作することを確認
**テストケース**:
- `==基本ハイライト==` → `<mark>基本ハイライト</mark>`
- `==**太字**==` → `<mark><strong>太字</strong></mark>`
- コードブロック内の`==`は無視

### FT-002: セキュリティ機能の維持
**目的**: XSS防止機能が維持されていることを確認
**テストケース**:
- `==<script>alert('XSS')</script>==` → 適切にエスケープ
- `==<div onclick="malicious()">==` → イベントハンドラー無効化

### FT-003: エッジケース処理の維持
**目的**: エッジケース対応が維持されていることを確認
**テストケース**:
- 空のハイライト`====`は処理しない
- 改行を含む場合は処理しない
- 奇数個の`==`は処理しない

## 4. 回帰テスト

### RT-001: 既存テストスイートの実行
**目的**: 既存の全テストケースが成功することを確認
**テスト手順**:
1. `test/mark-highlight-isolated-test.js`を実行
2. `test/mark-highlight-advanced-test.js`を実行
3. `test/mark-highlight-integration-test.js`を実行
**期待結果**: 最適化前と同じ成功率

### RT-002: 統合環境での動作確認
**目的**: Astro環境での統合動作確認
**テスト手順**:
1. `npm run build`を実行
2. ビルドエラーがないことを確認
3. 生成されたHTMLを検証
**期待結果**: エラーなくビルド完了

## 5. ベンチマークテスト

### BT-001: 処理速度ベンチマーク
**目的**: 最適化前後の処理速度比較
**測定項目**:
- 小規模（100文字）: 改善率50%以上
- 中規模（1000文字）: 改善率40%以上
- 大規模（10000文字）: 改善率30%以上

### BT-002: メモリ使用量ベンチマーク
**目的**: 最適化前後のメモリ使用量比較
**測定項目**:
- 基本処理: 30%以上削減
- 大規模処理: 25%以上削減
- ピーク使用量: 20%以上削減

### BT-003: スループットベンチマーク
**目的**: 単位時間あたりの処理能力測定
**測定項目**:
- ops/sec: 30%以上向上
- 並行処理能力: 劣化なし

## テスト実行計画

### Phase 1: 最適化前の測定
1. 現在の性能ベースラインを記録
2. メモリ使用パターンを記録

### Phase 2: 段階的最適化と測定
1. デバッグログ削除後の測定
2. 正規表現最適化後の測定
3. AST処理統合後の測定

### Phase 3: 最終検証
1. 全テストケースの実行
2. パフォーマンス目標の達成確認
3. 回帰テストの実施

## 合格基準

1. **パフォーマンステスト**: 全項目で目標値達成
2. **メモリテスト**: メモリリークなし、使用量30%削減
3. **機能テスト**: 100%合格
4. **回帰テスト**: 既存テストの合格率維持
5. **ベンチマーク**: 改善目標達成