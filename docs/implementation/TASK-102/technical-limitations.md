# TASK-102: エスケープ処理の技術的制約

## 制約の詳細

### remarkのエスケープ処理の優先順位
remarkのMarkdownパーサーは、プラグインが実行される前にバックスラッシュエスケープを処理します：

```
入力: \==text==
↓ remarkパーサー
AST: text node with value "==text=="
↓ プラグイン実行
出力: <mark>text</mark>
```

### プラグインレベルでの制約
- プラグインは既に処理されたASTを受け取る
- 元のバックスラッシュ情報は失われている
- エスケープ検出が不可能

## 実装された機能

### 1. コード除外機能 ✅
- **フェンスドコードブロック内**: remarkが`code`ノードとして処理
- **インラインコード内**: remarkが`inlineCode`ノードとして処理
- プラグインは`text`ノードのみを処理するため、自然に除外される

### 2. 既存機能の回帰テスト ✅
- 基本的なハイライト機能: 正常動作
- 複数行ハイライト機能: 正常動作

## 代替案

### 1. remarkパーサーフックの利用
remarkの構文解析段階でカスタムフックを実装する必要がある（高難度）

### 2. 独自記法の採用
エスケープが必要ない記法への変更（仕様変更が必要）

### 3. 将来の拡張ポイント
remarkの内部APIやプラグインアーキテクチャの進化を待つ

## 結論

現在のプラグインアーキテクチャでは、エスケープ処理の完全な実装は技術的に困難。
コード除外機能は正常に動作し、基本機能に影響はない。