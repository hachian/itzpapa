---
// テーマ切り替えボタンコンポーネント
// ライトモード/ダークモードの切り替えを行う
---

<button
	class="theme-toggle"
	type="button"
	aria-label="ダークモードに切り替え"
	data-theme-toggle
>
	<!-- 太陽アイコン（ライトモード時に表示） -->
	<svg class="theme-toggle__icon theme-toggle__icon--sun" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
		<path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/>
	</svg>
	<!-- 月アイコン（ダークモード時に表示） -->
	<svg class="theme-toggle__icon theme-toggle__icon--moon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
		<path fill="currentColor" d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/>
	</svg>
</button>

<script>
	function setupThemeToggle() {
		const toggleBtns = document.querySelectorAll('[data-theme-toggle]');
		if (toggleBtns.length === 0) return;

		// 現在のテーマに基づいて全てのボタンのaria-labelを更新
		function updateToggleState() {
			const isDark = document.documentElement.classList.contains('dark');
			toggleBtns.forEach(btn => {
				btn.setAttribute('aria-label', isDark ? 'ライトモードに切り替え' : 'ダークモードに切り替え');
			});
		}

		// 初期状態を設定
		updateToggleState();

		// 各ボタンにクリックイベントを設定
		toggleBtns.forEach(btn => {
			// 既存のリスナーを削除するため、一度クローンして置き換え
			const newBtn = btn.cloneNode(true);
			btn.parentNode?.replaceChild(newBtn, btn);

			newBtn.addEventListener('click', () => {
				const isDark = document.documentElement.classList.contains('dark');

				if (isDark) {
					document.documentElement.classList.remove('dark');
					document.documentElement.classList.add('light');
					localStorage.setItem('theme', 'light');
				} else {
					document.documentElement.classList.add('dark');
					document.documentElement.classList.remove('light');
					localStorage.setItem('theme', 'dark');
				}

				// 全てのボタンの状態を更新
				document.querySelectorAll('[data-theme-toggle]').forEach(b => {
					b.setAttribute('aria-label', !isDark ? 'ライトモードに切り替え' : 'ダークモードに切り替え');
				});
			});
		});
	}

	// 初回ロード時に実行
	setupThemeToggle();

	// View Transitions後に実行
	document.addEventListener('astro:after-swap', setupThemeToggle);
</script>

<style>
	.theme-toggle {
		display: flex;
		align-items: center;
		justify-content: center;
		width: var(--touch-target-min);
		height: var(--touch-target-min);
		padding: 0;
		background: transparent;
		border: none;
		border-radius: var(--radius-full);
		cursor: pointer;
		color: var(--color-text-secondary);
		transition: color var(--duration-fast) var(--easing-default),
					background-color var(--duration-fast) var(--easing-default);
	}

	.theme-toggle:hover {
		color: var(--color-primary-500);
		background-color: var(--color-primary-50);
	}

	.theme-toggle:focus-visible {
		outline: var(--focus-ring-width) solid var(--focus-ring-color);
		outline-offset: var(--focus-ring-offset);
	}

	.theme-toggle__icon {
		transition: opacity var(--duration-fast) var(--easing-default),
					transform var(--duration-fast) var(--easing-default);
	}

	/* ライトモード時：太陽表示、月非表示 */
	.theme-toggle__icon--sun {
		display: block;
	}

	.theme-toggle__icon--moon {
		display: none;
	}

	/* ダークモード時：月表示、太陽非表示 */
	html.dark .theme-toggle__icon--sun {
		display: none;
	}

	html.dark .theme-toggle__icon--moon {
		display: block;
	}

	/* ダークモードでのホバー */
	html.dark .theme-toggle:hover {
		color: var(--color-primary-400);
		background-color: oklch(30% 0.08 293);
	}
</style>
