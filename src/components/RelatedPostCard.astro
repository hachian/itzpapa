---
/**
 * 関連記事カードコンポーネント
 * 個別の関連記事を表示するカード（ブログ一覧ページと同じスタイル）
 */
import { Image } from 'astro:assets';
import FormattedDate from './FormattedDate.astro';
import { removeDatePrefix } from '../plugins/utils/index.js';

// フォールバック用のデフォルトhero画像
import defaultHeroLight from '../assets/itzpapa-light_16_9.png';
import defaultHeroDark from '../assets/itzpapa-dark_16_9.png';

interface Props {
  /** 記事ID（リンク生成用） */
  id: string;
  /** 記事タイトル */
  title: string;
  /** 公開日 */
  published: Date;
  /** 説明文（オプション） */
  description?: string;
  /** アイキャッチ画像（オプション） */
  image?: ImageMetadata;
}

const { id, title, published, description, image } = Astro.props;
const slug = removeDatePrefix(id);
const href = `/blog/${slug}/`;
---

<article class="post-card">
  <a href={href} class="post-card__image-link">
    <div class="post-card__image-wrapper">
      {image ? (
        <Image
          width={720}
          height={360}
          src={image}
          alt=""
          class="post-card__image"
          loading="lazy"
          decoding="async"
          format="webp"
        />
      ) : import.meta.env.DEV ? (
        <>
          <Image
            width={720}
            height={360}
            src={defaultHeroLight}
            alt=""
            class="post-card__image post-card__image--light"
            loading="lazy"
            decoding="async"
            format="webp"
          />
          <Image
            width={720}
            height={360}
            src={defaultHeroDark}
            alt=""
            class="post-card__image post-card__image--dark"
            loading="lazy"
            decoding="async"
            format="webp"
          />
        </>
      ) : (
        <>
          <img
            width="720"
            height="360"
            src={`/hero/${slug}-light.png`}
            alt=""
            class="post-card__image post-card__image--light"
            loading="lazy"
            decoding="async"
          />
          <img
            width="720"
            height="360"
            src={`/hero/${slug}-dark.png`}
            alt=""
            class="post-card__image post-card__image--dark"
            loading="lazy"
            decoding="async"
          />
        </>
      )}
    </div>
  </a>
  <div class="post-card__content">
    <a href={href} class="post-card__title-link">
      <h4 class="post-card__title">{title}</h4>
    </a>
    {description && (
      <p class="post-card__description">{description}</p>
    )}
    <time class="post-card__date" datetime={published.toISOString()}>
      <FormattedDate date={published} />
    </time>
  </div>
</article>

<style>
  .post-card {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: transform var(--duration-normal) var(--easing-default),
          box-shadow var(--duration-normal) var(--easing-default);
  }

  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .post-card__image-link {
    display: block;
    text-decoration: none;
  }

  .post-card__title-link {
    text-decoration: none;
    color: inherit;
  }

  .post-card__title-link:hover .post-card__title,
  .post-card__title-link:focus .post-card__title {
    color: var(--color-primary-500);
  }

  .post-card__title-link:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
  }

  .post-card__image-wrapper {
    aspect-ratio: 16 / 9;
    background: var(--color-gray-100);
  }

  .post-card__image {
    width: 100%;
    aspect-ratio: 16 / 9;
    object-fit: cover;
  }

  /* デフォルトhero画像のダークモード切り替え */
  .post-card__image-wrapper img.post-card__image--light {
    display: block;
  }

  .post-card__image-wrapper img.post-card__image--dark {
    display: none;
  }

  html.dark .post-card__image-wrapper {
    background: var(--color-gray-700);
  }

  html.dark .post-card__image-wrapper img.post-card__image--light {
    display: none;
  }

  html.dark .post-card__image-wrapper img.post-card__image--dark {
    display: block;
  }

  .post-card__content {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    padding: var(--space-5);
  }

  .post-card__title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    line-height: var(--line-height-snug);
    margin: 0 0 var(--space-2) 0;
    transition: color var(--duration-fast) var(--easing-default);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card__description {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin: 0 0 var(--space-4) 0;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card__date {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-primary-500);
    margin-top: auto;
  }

  /* ダークモード */
  html.dark .post-card {
    background: var(--color-gray-800);
  }

  html.dark .post-card:hover {
    box-shadow: 0 20px 40px oklch(0% 0 0 / 0.4);
  }

  @media (prefers-color-scheme: dark) {
    html:not(.light) .post-card {
      background: var(--color-gray-800);
    }

    html:not(.light) .post-card:hover {
      box-shadow: 0 20px 40px oklch(0% 0 0 / 0.4);
    }

    html:not(.light) .post-card__image-wrapper {
      background: var(--color-gray-700);
    }

    html:not(.light) .post-card__image-wrapper img.post-card__image--light {
      display: none;
    }

    html:not(.light) .post-card__image-wrapper img.post-card__image--dark {
      display: block;
    }
  }
</style>
