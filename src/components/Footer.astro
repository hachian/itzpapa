---
import { siteConfig, SITE_TITLE } from '../../site.config';
import SocialIcon from './SocialIcon.astro';
import type { SocialType } from './SocialIcon.astro';

// 設定から必要な情報を取得
const { site, navigation, social, footer } = siteConfig;
const { author } = site;
const { copyrightText, startYear } = footer;

// 現在の年
const currentYear = new Date().getFullYear();

// 年の表示を生成（startYear が設定されていれば「startYear - currentYear」形式）
const yearDisplay = startYear && startYear < currentYear
  ? `${startYear} - ${currentYear}`
  : String(currentYear);

// 有効な SNS リンクのみをフィルタリング（enabled=true かつ URL が空でない）
const enabledSocialLinks = Object.entries(social)
  .filter(([_, config]) => {
    if (config.enabled && !config.url) {
      console.warn(`SNS "${_}" は有効ですが URL が設定されていません`);
      return false;
    }
    return config.enabled && config.url;
  })
  .map(([type, config]) => ({ type: type as SocialType, url: config.url }));
---

<footer class="footer" transition:persist>
	<div class="footer__container">
		<nav class="footer__nav">
			{navigation.map((item) => (
				<a href={item.href} class="footer__link">{item.label}</a>
			))}
		</nav>

		{enabledSocialLinks.length > 0 && (
			<div class="footer__social">
				{enabledSocialLinks.map(({ type, url }) => (
					<a href={url} target="_blank" rel="noopener noreferrer" class="footer__social-link">
						<span class="sr-only">{type}</span>
						<SocialIcon type={type} size={24} />
					</a>
				))}
			</div>
		)}

		<p class="footer__copyright">
			&copy; {yearDisplay} {author || SITE_TITLE}. {copyrightText || 'All rights reserved.'}
		</p>
	</div>
</footer>

<style>
	.footer {
		background: var(--color-gray-100);
		border-top: 1px solid var(--color-gray-200);
		padding: var(--space-12) var(--space-6) var(--space-16);
	}

	.footer__container {
		max-width: 1200px;
		margin: 0 auto;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: var(--space-6);
	}

	.footer__nav {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: var(--space-4);
	}

	.footer__link {
		font-size: var(--font-size-base);
		color: var(--color-text-secondary);
		text-decoration: none;
		padding: var(--space-2);
		border-radius: var(--radius-md);
		transition: color var(--duration-fast) var(--easing-default),
					background-color var(--duration-fast) var(--easing-default);
	}

	.footer__link:hover {
		color: var(--color-primary-500);
		background-color: var(--color-primary-50);
	}

	.footer__link:focus-visible {
		outline: var(--focus-ring-width) solid var(--focus-ring-color);
		outline-offset: var(--focus-ring-offset);
	}

	.footer__social {
		display: flex;
		gap: var(--space-3);
	}

	.footer__social-link {
		display: flex;
		align-items: center;
		justify-content: center;
		width: var(--touch-target-min);
		height: var(--touch-target-min);
		color: var(--color-text-secondary);
		border-radius: var(--radius-full);
		transition: color var(--duration-fast) var(--easing-default),
					background-color var(--duration-fast) var(--easing-default);
	}

	.footer__social-link:hover {
		color: var(--color-primary-500);
		background-color: var(--color-primary-50);
	}

	.footer__social-link:focus-visible {
		outline: var(--focus-ring-width) solid var(--focus-ring-color);
		outline-offset: var(--focus-ring-offset);
	}

	.footer__copyright {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
		text-align: center;
		margin: 0;
	}

	/* ダークモード */
	html.dark .footer {
		background: var(--color-gray-900);
		border-top-color: var(--color-gray-700);
	}

	html.dark .footer__link {
		color: var(--color-gray-200);
	}

	html.dark .footer__link:hover,
	html.dark .footer__social-link:hover {
		color: var(--color-primary-400);
		background-color: var(--color-primary-hover-dark);
	}

	html.dark .footer__social-link {
		color: var(--color-gray-200);
	}

	html.dark .footer__copyright {
		color: var(--color-gray-300);
	}
</style>
