---
/**
 * タグバッジコンポーネント
 * 個別のタグを表示するための再利用可能なコンポーネント
 */

interface Props {
  /** タグ名 */
  tag: string;
  /** タグを表示するURL（省略時はリンクなし） */
  href?: string;
  /** 使用回数（省略時は表示しない） */
  count?: number;
  /** 階層タグかどうか */
  isHierarchical?: boolean;
  /** 追加のCSSクラス */
  className?: string;
  /** アクセシビリティ用のaria-label */
  ariaLabel?: string;
}

const { 
  tag, 
  href, 
  count, 
  isHierarchical = false, 
  className = '',
  ariaLabel
} = Astro.props;

// タグ名を正規化（#プレフィックスを確実に追加）
const displayTag = tag.startsWith('#') ? tag : `#${tag}`;

// CSSクラスを構築
const tagClasses = [
  'tag',
  isHierarchical ? 'tag-hierarchical' : '',
  className
].filter(Boolean).join(' ');

// アクセシビリティ属性
const accessibility = {
  'aria-label': ariaLabel || `タグ: ${tag}${count ? ` (${count}個の記事)` : ''}`,
  'role': href ? 'link' : 'text',
  'tabindex': href ? '0' : undefined
};
---

{href ? (
  <a 
    href={href}
    class={tagClasses}
    {...accessibility}
  >
    <span class="tag-text">{displayTag}</span>
    {count && count > 0 && (
      <span class="tag-count" aria-hidden="true">
        {count}
      </span>
    )}
  </a>
) : (
  <span 
    class={tagClasses}
    {...accessibility}
  >
    <span class="tag-text">{displayTag}</span>
    {count && count > 0 && (
      <span class="tag-count" aria-hidden="true">
        {count}
      </span>
    )}
  </span>
)}

<style>
  .tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25em;
    padding: 0.2em 0.6em;
    margin: 0 0.2em 0.2em 0;
    background-color: var(--tag-bg, #e1f5fe);
    color: var(--tag-color, #0277bd);
    border: 1px solid var(--tag-border, #b3e5fc);
    border-radius: 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s ease;
    white-space: nowrap;
    cursor: default;
  }
  
  .tag:where(a) {
    cursor: pointer;
  }
  
  .tag-hierarchical {
    background-color: var(--tag-hierarchical-bg, #fff8e1);
    color: var(--tag-hierarchical-color, #f57f17);
    border-color: var(--tag-hierarchical-border, #ffecb3);
  }
  
  /* ホバー効果 */
  .tag:where(a):hover,
  .tag:where(a):focus {
    background-color: var(--tag-hover-bg, #0277bd);
    color: var(--tag-hover-color, #ffffff);
    border-color: var(--tag-hover-border, #0277bd);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .tag-hierarchical:where(a):hover,
  .tag-hierarchical:where(a):focus {
    background-color: var(--tag-hierarchical-hover-bg, #f57f17);
    color: var(--tag-hierarchical-hover-color, #ffffff);
    border-color: var(--tag-hierarchical-hover-border, #f57f17);
  }
  
  /* フォーカス表示 */
  .tag:where(a):focus {
    outline: 2px solid var(--focus-color, #2196f3);
    outline-offset: 2px;
  }
  
  .tag-text {
    font-family: inherit;
  }
  
  .tag-count {
    background-color: rgba(255, 255, 255, 0.3);
    color: inherit;
    padding: 0.1em 0.4em;
    border-radius: 0.75rem;
    font-size: 0.75em;
    font-weight: 600;
    min-width: 1.2em;
    text-align: center;
  }
  
  /* ダークモード対応 */
  html.dark .tag {
    background-color: var(--tag-dark-bg, #1e3a8a);
    color: var(--tag-dark-color, #93c5fd);
    border-color: var(--tag-dark-border, #1e40af);
  }
  
  html.dark .tag-hierarchical {
    background-color: var(--tag-hierarchical-dark-bg, #7c2d12);
    color: var(--tag-hierarchical-dark-color, #fed7aa);
    border-color: var(--tag-hierarchical-dark-border, #9a3412);
  }
  
  html.dark .tag:where(a):hover,
  html.dark .tag:where(a):focus {
    background-color: var(--tag-dark-hover-bg, #3b82f6);
    color: var(--tag-dark-hover-color, #ffffff);
    border-color: var(--tag-dark-hover-border, #3b82f6);
  }
  
  html.dark .tag-hierarchical:where(a):hover,
  html.dark .tag-hierarchical:where(a):focus {
    background-color: var(--tag-hierarchical-dark-hover-bg, #ea580c);
    color: var(--tag-hierarchical-dark-hover-color, #ffffff);
    border-color: var(--tag-hierarchical-dark-hover-border, #ea580c);
  }
  
  /* 小さい画面での調整 */
  @media (max-width: 640px) {
    .tag {
      font-size: 0.8rem;
      padding: 0.15em 0.5em;
    }
    
    .tag-count {
      font-size: 0.7em;
      padding: 0.05em 0.3em;
    }
  }
</style>