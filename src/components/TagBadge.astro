---
/**
 * タグバッジコンポーネント
 * 個別のタグを表示するための再利用可能なコンポーネント
 * 
 * 階層タグと単一タグを統一されたスタイルで表示します。
 * CSS変数を使用してテーマとダークモードに対応。
 */

interface Props {
  /** タグ名 */
  tag: string;
  /** タグを表示するURL（省略時はリンクなし） */
  href?: string;
  /** 使用回数（省略時は表示しない） */
  count?: number;
  /** 追加のCSSクラス */
  className?: string;
  /** アクセシビリティ用のaria-label */
  ariaLabel?: string;
}

const { 
  tag, 
  href, 
  count, 
  className = '',
  ariaLabel
} = Astro.props;

// タグ名を正規化（#プレフィックスを確実に追加）
const displayTag = tag.startsWith('#') ? tag : `#${tag}`;

// CSSクラスを構築 - 統一スタイル適用（isHierarchicalによる区別を廃止）
const tagClasses = [
  'tag',
  className
].filter(Boolean).join(' ');

// アクセシビリティ属性
const accessibility = {
  'aria-label': ariaLabel || `タグ: ${tag}${count ? ` (${count}個の記事)` : ''}`,
  'role': href ? 'link' : 'text',
  'tabindex': href ? '0' : undefined
};
---

{href ? (
  <a 
    href={href}
    class={tagClasses}
    {...accessibility}
  >
    <span class="tag-text">{displayTag}</span>
    {count && count > 0 && (
      <span class="tag-count" aria-hidden="true">
        {count}
      </span>
    )}
  </a>
) : (
  <span 
    class={tagClasses}
    {...accessibility}
  >
    <span class="tag-text">{displayTag}</span>
    {count && count > 0 && (
      <span class="tag-count" aria-hidden="true">
        {count}
      </span>
    )}
  </span>
)}

<style>
  .tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25em;
    padding: var(--tag-padding-y) var(--tag-padding-x);
    margin: 0 var(--tag-margin-x) var(--tag-margin-y) 0;
    background-color: var(--tag-bg);
    color: var(--tag-color);
    border: 1px solid var(--tag-border);
    border-radius: var(--tag-border-radius);
    font-size: var(--tag-font-size);
    font-weight: var(--tag-font-weight);
    line-height: var(--tag-line-height);
    text-decoration: none;
    transition: all var(--tag-transition-duration) var(--tag-transition-easing);
    white-space: nowrap;
    cursor: default;
  }
  
  .tag:where(a) {
    cursor: pointer;
  }
  
  
  /* ホバー効果 - 統一スタイル */
  .tag:where(a):hover,
  .tag:where(a):focus {
    background-color: var(--tag-hover-bg);
    color: var(--tag-hover-color);
    border-color: var(--tag-hover-border);
    transform: var(--tag-hover-transform);
    box-shadow: var(--tag-hover-shadow);
  }
  
  /* フォーカス表示 */
  .tag:where(a):focus {
    outline: 2px solid var(--tag-focus-color);
    outline-offset: var(--tag-focus-offset);
  }
  
  .tag-text {
    font-family: inherit;
  }
  
  .tag-count {
    background-color: var(--tag-count-bg);
    color: inherit;
    padding: var(--tag-count-padding-y) var(--tag-count-padding-x);
    border-radius: var(--tag-count-border-radius);
    font-size: var(--tag-count-font-size);
    font-weight: var(--tag-count-font-weight);
    min-width: var(--tag-count-min-width);
    text-align: center;
  }
  
  /* ダークモード対応 - 統一スタイル */
  html.dark .tag {
    background-color: var(--tag-bg);
    color: var(--tag-color);
    border-color: var(--tag-border);
  }
  
  html.dark .tag:where(a):hover,
  html.dark .tag:where(a):focus {
    background-color: var(--tag-hover-bg);
    color: var(--tag-hover-color);
    border-color: var(--tag-hover-border);
  }
  
  /* 小さい画面での調整 - CSS変数使用 */
  @media (max-width: 640px) {
    .tag {
      font-size: var(--tag-mobile-font-size);
      padding: var(--tag-mobile-padding-y) var(--tag-mobile-padding-x);
    }
    
    .tag-count {
      font-size: var(--tag-mobile-count-font-size);
      padding: var(--tag-mobile-count-padding-y) var(--tag-mobile-count-padding-x);
    }
  }

  /* アクセシビリティ: タッチデバイス用の最小タップサイズ確保 */
  @media (hover: none) and (pointer: coarse) {
    .tag {
      min-height: var(--tag-min-tap-size);
      min-width: var(--tag-min-tap-size);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
  }
</style>