# Implementation Plan

## Task 1: ライトボックスCSSスタイル作成

- [x] 1. (P) ライトボックスのスタイルシート作成
  - オーバーレイ背景（半透明ダーク）のスタイル定義
  - 画像を中央配置し、画面サイズに応じた最大幅・高さ制限
  - 閉じるボタン（×アイコン）を右上に固定配置
  - キャプション領域のスタイル（画像下部に配置）
  - 表示・非表示のアニメーション（フェードイン・アウト）
  - 既存のデザイントークン（z-index, カラー, アニメーション変数）を使用
  - _Requirements: 1.4, 2.1, 5.1_

- [x] 1.1 (P) ダークモード・ライトモードのスタイル対応
  - `html.dark` クラスによるダークモードスタイル
  - `@media (prefers-color-scheme: dark)` + `:root:not(.light)` でOS設定対応
  - OKLCHカラーシステムに準拠した配色
  - _Requirements: 3.1, 3.2_

- [x] 1.2 (P) レスポンシブスタイルの実装
  - モバイルビューポート（768px未満）での画像サイズ調整
  - タッチターゲットサイズの確保（閉じるボタン44px以上）
  - 横向き・縦向き表示の最適化
  - _Requirements: 5.1_

## Task 2: ライトボックスコンポーネント作成

- [x] 2. ライトボックスAstroコンポーネントの実装
- [x] 2.1 ライトボックスオーバーレイのDOM構造作成
  - モーダルダイアログとしてのオーバーレイ要素
  - 拡大表示用の画像要素
  - alt属性テキストを表示するキャプション要素
  - 閉じるボタン（×アイコン）
  - `role="dialog"`, `aria-modal="true"` の設定
  - 閉じるボタンに `aria-label` 属性を設定
  - _Requirements: 1.1, 1.4, 1.5, 2.1, 4.3_

- [x] 2.2 画像クリックでライトボックスを開く機能
  - 記事本文内の画像要素にクリックイベントリスナーを登録
  - クリックされた画像のsrc属性とalt属性を取得
  - ライトボックスを表示し、取得した画像を拡大表示
  - src属性が無効な場合は処理をスキップ
  - タッチデバイスでのタップ操作にも対応（clickイベント）
  - _Requirements: 1.1, 5.2_

- [x] 2.3 ライトボックスを閉じる機能
  - 背景オーバーレイクリックで閉じる
  - 閉じるボタンクリックで閉じる
  - Escapeキー押下で閉じる
  - 閉じる際のフェードアウトアニメーション
  - _Requirements: 1.2, 1.3, 2.2_

- [x] 2.4 フォーカス管理の実装
  - ライトボックスを開いたときにフォーカスをオーバーレイ内に移動
  - クリックした画像要素への参照を保持
  - ライトボックスを閉じたときに元の画像にフォーカスを戻す
  - _Requirements: 4.1, 4.2_

## Task 3: システム統合

- [x] 3. BlogPost.astroへのコンポーネント統合
  - ライトボックスコンポーネントをbody末尾に配置
  - lightbox.cssをglobal.cssにインポート
  - View Transition対応（`astro:page-load` イベントでの再初期化）
  - 既存のCallout folding機能との共存確認
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 3.1, 3.2, 4.1, 4.2, 4.3, 5.1, 5.2_

## Task 4: 動作検証

- [x] 4. 手動テストによる動作確認
- [x] 4.1 基本機能の動作確認
  - 画像クリックでライトボックスが開く
  - 背景クリック、Escapeキー、閉じるボタンで閉じる
  - alt属性がキャプションとして表示される
  - _Requirements: 1.1, 1.2, 1.3, 1.5, 2.2_

- [x] 4.2 ダークモード・レスポンシブの確認
  - ダークモードでのスタイル表示確認
  - ライトモードでのスタイル表示確認
  - モバイルビューポートでの表示確認
  - タッチ操作での動作確認
  - _Requirements: 3.1, 3.2, 5.1, 5.2_

- [x] 4.3 アクセシビリティの確認
  - キーボードのみでの操作確認（Tab、Escape）
  - スクリーンリーダーでのaria-label読み上げ確認
  - フォーカス移動・復帰の動作確認
  - _Requirements: 4.1, 4.2, 4.3_
