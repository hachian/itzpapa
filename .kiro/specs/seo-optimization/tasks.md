# Implementation Plan: SEO Optimization

## Tasks

- [x] 1. robots.txtの作成
  - クローラー制御とサイトマップ参照を含む静的ファイルを作成
  - _Requirements: 1.1, 1.2, 1.4_

- [x] 1.1 (P) robots.txtファイルの作成
  - すべてのクローラーに対する基本的な許可ルールを設定
  - APIエンドポイントとテストページへのクロールを禁止
  - サイトマップのURLを参照として追加
  - サイト設定からベースURLを使用してサイトマップURLを構築
  - _Requirements: 1.1, 1.2, 1.4_

- [x] 2. SEOユーティリティの実装
  - テキスト切り詰め機能を提供するユーティリティを作成

- [x] 2.1 (P) テキスト切り詰め関数の実装
  - 指定文字数での切り詰めと省略記号追加機能を実装
  - 日本語を含むマルチバイト文字に対応（サロゲートペア考慮）
  - 空文字・null安全な処理を実装
  - デフォルト160文字制限、カスタマイズ可能なパラメータ
  - _Requirements: 3.3_

- [x] 3. 構造化データコンポーネントの実装
  - JSON-LD形式で検索エンジン向け構造化データを出力

- [x] 3.1 BlogPosting型JSON-LDの実装
  - ブログ記事用の構造化データスキーマを出力
  - タイトル、説明、公開日、更新日、著者、画像を含める
  - 更新日が未設定の場合は公開日をフォールバック
  - サイト設定から著者情報を取得
  - 日付をISO 8601形式で出力
  - すべてのURLを絶対URL形式で出力
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 3.2 WebSite型JSON-LDの実装
  - トップページ用のサイト情報構造化データを出力
  - サイト名とURLをサイト設定から取得
  - _Requirements: 2.4_

- [x] 3.3 BreadcrumbList型JSON-LDの実装
  - パンくずナビゲーション用の構造化データを出力
  - 既存のパンくずリストデータを構造化データ形式に変換
  - 各項目にposition、name、itemを含める
  - _Requirements: 2.5_

- [x] 4. メタタグコンポーネントの拡張
  - 既存のhead管理コンポーネントにSEO機能を追加

- [x] 4.1 タイトルタグ形式の変更
  - 「記事タイトル | サイト名」形式でタイトルを出力
  - トップページの場合は形式変更をスキップ
  - 既存の呼び出し元との後方互換性を維持
  - _Requirements: 3.2_

- [x] 4.2 説明文の切り詰め処理統合
  - メタタグ出力時に説明文を160文字で切り詰め
  - 切り詰めユーティリティを使用して処理
  - _Requirements: 3.3_

- [x] 4.3 記事用Open Graphタグの追加
  - 記事ページで公開日時と更新日時のOGタグを出力
  - 記事のタグ情報をOGタグとして出力
  - 記事情報が渡された場合のみタグを出力（条件付き）
  - _Requirements: 3.4, 3.5_

- [x] 5. URL末尾スラッシュの統一設定
  - Astro設定でURL正規化を有効化
  - _Requirements: 6.3_

- [x] 5.1 (P) trailingSlash設定の追加
  - Astro設定ファイルに末尾スラッシュ統一オプションを追加
  - 既存の`/blog/{slug}/`パターンと一致する設定を適用
  - canonical URLとの整合性を確保
  - _Requirements: 6.3_

- [x] 6. ページへの統合
  - 各ページに構造化データとメタタグ拡張を適用

- [x] 6.1 トップページへのWebSite JSON-LD統合
  - トップページにWebSite型構造化データを追加
  - head内の適切な位置にコンポーネントを配置
  - _Requirements: 2.4_

- [x] 6.2 ブログ記事ページへの統合
  - BlogPosting型JSON-LDをブログ記事レイアウトに追加
  - BreadcrumbList型JSON-LDをパンくず表示箇所に追加
  - 記事メタデータ（公開日、更新日、タグ）をメタタグコンポーネントに渡す
  - _Requirements: 2.1, 2.2, 2.3, 2.5, 3.4, 3.5_

- [x] 7. 検証とテスト
  - 実装した機能の動作確認と品質検証

- [x] 7.1 truncateText関数のユニットテスト
  - 通常テキストの切り詰め動作を検証
  - 空文字・null入力の安全性を検証
  - 日本語文字数カウントの正確性を検証
  - サロゲートペア（絵文字等）の処理を検証
  - _Requirements: 3.3_

- [x] 7.2 ビルド・出力検証
  - ビルドが正常に完了することを確認
  - robots.txtが出力ディレクトリに含まれることを確認
  - 各ページのHTML出力にJSON-LDスクリプトが含まれることを確認
  - メタタグが期待通りの形式で出力されることを確認
  - _Requirements: 1.1, 1.2, 1.4, 2.1, 2.4, 2.5, 3.2, 3.4, 3.5, 6.3_

## Deferred Requirements

以下の要件は既存実装で充足済みのため、本機能スコープ外:

- **Req 3.1**: 各ページにユニークなtitle/description設定 → 既存BaseHead.astroで対応済み
- **Req 4.1-4.5**: パフォーマンス最適化 → 既存実装で充足（WebP、lazy loading、CSS分割、font-display）
- **Req 5.1-5.5**: アクセシビリティ → 既存実装で充足（alt属性、見出し階層、aria属性）
- **Req 6.1, 6.2, 6.4**: URL構造 → 既存実装で充足（/blog/{slug}/、/tags/{tag}/、canonical URL）
- **Req 7.1-7.4**: 内部リンク構造 → 既存実装で充足（タグリンク、パンくず、WikiLink、タグ一覧）
