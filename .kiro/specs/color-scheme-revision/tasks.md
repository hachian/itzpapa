# Implementation Plan

## Tasks

- [x] 1. 現状確認とベースライン取得
- [x] 1.1 Playwrightで変更前のスクリーンショットを取得
  - 開発サーバーを起動し、主要5ページ（ホーム、ブログ一覧、ブログ記事、タグ、About）を巡回
  - ライトモードとダークモードの両方でスクリーンショットを取得
  - デスクトップ（1280px）、タブレット（768px）、モバイル（375px）の3ビューポートで確認
  - スクリーンショットを比較用に保存（before/ディレクトリ等）
  - _Requirements: verification-strategy_

- [x] 2. ダークモード明度の最適化
- [x] 2.1 design-tokens.cssのダークモード背景色を調整
  - ダークモードの背景色（gray-900）の明度を15%から22%に変更
  - サーフェス色（gray-800）の明度を25%から30%に変更
  - グレースケールの色相をプライマリhueと連動させる
  - @media (prefers-color-scheme: dark)内の値も同様に更新
  - _Requirements: 4.1, 4.2_

- [x] 2.2 Playwrightでダークモード変更を視覚確認
  - ダークモードでのページ表示を確認
  - 背景が明るくなり目に優しくなったことを検証
  - テキストとのコントラスト比が維持されていることを確認
  - _Requirements: 4.1, 4.2, 6.1, 6.4_

- [x] 3. セマンティックカラーの追加
- [x] 3.1 (P) 状態を表すセマンティックカラー変数を追加
  - success（緑）、warning（黄/オレンジ）、error（赤）、info（青）の色変数を定義
  - 各状態色に対して背景用の透過バージョン（-bg）も追加
  - ライトモードとダークモードの両方に対応した値を設定
  - _Requirements: 3.1, 3.2_

- [x] 3.2 (P) コンポーネント用の色変数を追加
  - 記事カード用変数（--article-bg, --article-border, --article-shadow）を定義
  - 汎用カード用変数（--card-bg, --card-border）を定義
  - ダークモードでのボーダー色を適切に調整
  - 既存のCSS変数との後方互換性を維持
  - _Requirements: 3.3, 3.4_

- [x] 4. ブログ本文エリアの背景分離
- [x] 4.1 BlogPost.astroに本文エリアの背景スタイルを追加
  - .blog-contentクラスに背景色、角丸、パディング、シャドウを適用
  - ライトモードでは白背景、ダークモードでは明るめのダークグレー背景を設定
  - .blog-layout-with-tocとの組み合わせ時のスタイル調整
  - モバイル時のパディング調整（レスポンシブ対応）
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 4.2 Playwrightで本文背景分離を視覚確認
  - ブログ記事ページで本文エリアがページ背景と区別されていることを確認
  - ライト/ダークモード両方で視覚的なコントラストを検証
  - シャドウまたは色差による境界の認識可能性を確認
  - 3ビューポートでのレスポンシブ表示を確認
  - _Requirements: 7.1, 7.4_

- [x] 5. プリセット配色システムの実装
- [x] 5.1 配色プリセットの型定義とデータを作成
  - ColorPresetインターフェース（name, primaryHue, description）を定義
  - 5つのプリセット（purple, ocean, forest, sunset, mono）を定義
  - ThemeConfig型を拡張してプリセット名または数値を受け付けるよう変更
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 5.2 プリセット解決ロジックを実装
  - プリセット名から色相値を解決する関数を作成
  - 数値指定（0-360）の場合はそのまま使用
  - 無効なプリセット名の場合はデフォルト（purple）にフォールバック
  - 範囲外の数値は0-360にクランプ
  - _Requirements: 1.1, 1.2, 1.4_

- [x] 5.3 BaseHead.astroでプリセット解決結果をCSS変数として注入
  - site.config.tsからテーマ設定を読み込み
  - プリセット解決関数を呼び出して色相値を取得
  - `<style>`タグ内で`--primary-hue`変数を設定
  - _Requirements: 1.1, 1.2_

- [x] 5.4 Playwrightで各プリセットの表示を確認
  - site.config.tsのテーマ設定を各プリセットに変更してビルド
  - 各プリセットでの配色が正しく適用されていることを確認
  - ライト/ダークモード両方でプリセットが機能することを検証
  - _Requirements: 1.1, 1.3_

- [x] 6. ライト/ダークモードの統一感確保
- [x] 6.1 両モードでのカラーパレット整合性を確認・調整
  - ライトモードとダークモードで同じ色相・彩度の関係性を維持
  - プライマリカラーの視覚的印象が両モードで統一されていることを確認
  - コンポーネント（ボタン、カード、タグ）の見た目の一貫性を検証
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 6.2 Playwrightで両モードの統一感を視覚確認
  - ライトモードとダークモードを切り替えて比較
  - 視覚的階層（コントラスト比の相対関係）が維持されていることを確認
  - モード切り替え時に違和感がないことを検証
  - _Requirements: 6.1, 6.4_

- [x] 7. Obsidian互換要素の配色確認
- [x] 7.1 タグとマークハイライトの配色がプライマリカラーと調和していることを確認
  - タグバッジの配色がプライマリカラーパレットから派生していることを確認
  - マークハイライト（==テキスト==）の背景色が視認性を保ちつつテーマと調和していることを確認
  - カスタムプリセット使用時に自動的に配色が調整されることを確認
  - _Requirements: 5.2, 5.3, 5.4_

- [x] 7.2 Calloutブロックの配色確認
  - Calloutの配色が全体的なテーマと調和していることを確認
  - 各種Calloutタイプ（note, info, tip, warning, caution, important, danger）の視認性を確認
  - ダークモードでの可読性を確認
  - _Requirements: 5.1_

- [x] 8. アクセシビリティ検証
- [x] 8.1 WCAG 2.1 AAコントラスト比の検証
  - 主要なテキストと背景の組み合わせでコントラスト比4.5:1以上を確認
  - 大きなテキスト（見出し等）で3:1以上のコントラスト比を確認
  - インタラクティブ要素（ボタン、リンク）の状態変化が識別可能であることを確認
  - ライト/ダークモード両方で同等のコントラスト比が維持されていることを確認
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 9. 最終統合確認
- [x] 9.1 全ページの最終Playwright確認
  - 変更後のスクリーンショットを取得
  - 変更前（ベースライン）との差分を確認
  - 5つの主要ページすべてで意図通りの表示になっていることを確認
  - 3ビューポート × 2モード（ライト/ダーク）の全パターンを検証
  - _Requirements: verification-strategy_

- [x] 9.2 ビルド成功と既存機能の動作確認
  - npm run buildが成功することを確認
  - 既存のテーマ切り替え機能が正常に動作することを確認
  - システムのカラースキーム設定変更時の自動切り替えを確認
  - ユーザーの手動切り替えがローカルストレージに保存されることを確認
  - _Requirements: 4.4, 4.5_
